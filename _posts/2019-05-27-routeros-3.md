---
layout: post
title:  "使用MikroTik产品实现网游加速"
date:   2019-05-27 12:59:06
categories: MikroTik RouterOS vpn
---

## 目的

在上一次我们聊了基础的网络配置已经可以正常上网了，但在日常使用中你可能还会遇到以下几个问题：

1. 境外网游联机慢，甚至无法联机比如switch上的马8、喷射
2. 部分网站无法访问。
3. 我家没有公网IP，在有些联机游戏中评级过低甚至无法联机。

今天我们就来讲下网络的优化。解决这个问题。之所以会出现国外网站网络延迟过大是几个原因。你的运营商到服务器的路由绕远了，比如同样是日本东京的IP，我就遇到过有从北京联通直接出口然后进入东京的路径延迟可以控制在100ms左右，也遇到过从北京联通绕到上海出口，走中美海底隧道进入美东，再折回日本东京延迟肯定在200ms以上。

再有就是访问某些网站时不管从哪个出口走就直接99.999%丢包的，这个就已经不是慢的问题了。

还有就是DNS被篡改了，解析有些域名返回的IP是错误的。即使你使用境外的DNS，在返回IP时也会遇到错误的IP先回来情况。

## 解决方案

我们先讲原理，以上情况我们可以划分为三种情况分开进行解决。

1. 访问慢，甚至无法访问，比如switch的联机主机就的IP解析出来后的IP为Google这家公司的机房，在大陆访问就会很慢甚至丢包。

    这个目前已知的解决方案都是建立隧道，让你的数据包可以正常出口，然后到隧道的尽头后进行解包再访问正常服务器。这里可以参考下GOOGL.INC的亚太机房主要在台湾彰化县和东京。咱们选隧道尽头的机器时尽量选这两个地点的。

2. DNS解析错误：返回了错误的IP，也可以按上面的方案解决，把所有已知返回错误IP域名的UDP请求53口的进行一下封装，全部放到隧道出口后进行解析。

    这个就要依赖路由支持应用层解析，也就是第7层。只对指定的域名做这个操作，所以地所有域名都进行如上操作，域名解析回来的都会是境外IP，你的1000兆体验可能会降落到10兆网络的感觉。

3. 没有公网IP的联机游戏无法拿到A类型：

    首先最低廉的解决方法就是给你的ISP打电话，要求ISP分配给你公网IP。如果投诉无果再考虑走隧道的方式，可以把隧道那头的DMZ指向你的路由，再从你的路由做端口映射到你的主机或游戏机。

## 在MikroTik上进行实操

1. 建立隧道